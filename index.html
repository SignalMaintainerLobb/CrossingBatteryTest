<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Battery Tester</title>
  <style>
    /* Battery Housing Container */
    #battery-popup {
      width: 300px;
      margin: 50px auto;
      padding: 20px;
      background-color: #f5f5f5;
      border: 2px solid #333;
      border-radius: 10px;
      font-family: sans-serif;

    }

    /* Battery Box */
    .battery-box {
      position: relative;
      width: 100%;
      height: 120px;
      background-color: #c0c0c0;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    /* Terminals */
    .terminal {
      position: absolute;
      width: 20px;
      height: 20px;
      background-color: #333;
      border-radius: 50%;
    }

    .positive {
      background-color: red;
    }

    .negative {
      background-color: black;
    }

    /* Positioning Terminals */
    #positive1 { top: 10px; left: -300px; }
    #positive2 {
     top: 40px;
     left: -301px;
     background-color: gold;
     border: 2px solid #cfa02c; /* Give it a little metallic definition */
     cursor: pointer;           /* Suggest interactivity */
}
    #positive3 { top: 70px; left: -300px; }

    #negative1 { bottom: 80px; left: -100px; }
    #negative2 { bottom: 50px; left: -100px; }

 /* Connection Lines */
    .connection-line {
      position: absolute;
      height: 2px;
      background-color: #000;
    }

#neg-connection {
  left: -91px;              /* Move it toward the left */
  top: 20px;               /* Set its vertical position */
  width: 2px;              /* Skinny width since it's now vertical */
  height: 30px;           /* Tall height to span vertically */
  background-color: black; /* Line color */
}


#pos-connection {
  left: -291px;              /* Move it toward the left */
  top: 20px;               /* Set its vertical position */
  width: 2px;              /* Skinny width since it's now vertical */
  height: 60px;           /* Tall height to span vertically */
  background-color: red; /* Line color */
}


    /* Measurements Display */
    .measurements {
      display: flex;
      flex-direction: column;
      gap: 5px;
      margin-bottom: 10px;
    }

    .measurement {
      font-weight: bold;
      background: #fff;
      padding: 5px;
      border: 1px solid #aaa;
      border-radius: 5px;
    }
 
#testSwitchBtn {
  padding: 10px;
  background-color: #ffa500;
  border: none;
  border-radius: 5px;
  color: #000;
  font-weight: bold;
  margin-top: 10px;
  cursor: pointer;
  }

#testSwitchBtn:hover {
  background-color: #cc8400;
  }

#crossingStatus {
  margin-top: 10px;
  font-weight: bold;
  }
  </style>
</head>
<body>

  <!-- Battery Tester Popup Interface -->
  <div id="battery-popup">

    <!-- Battery Housing -->
    <div class="battery-box">

      <!-- Terminals -->
      <div class="terminal positive" id="positive1"></div>
      <div class="terminal positive" id="positive2"></div>
      <div class="terminal positive" id="positive3"></div>

      <div class="terminal negative" id="negative1"></div>
      <div class="terminal negative" id="negative2"></div>

 <!-- Connection Lines -->
      <div class="connection-line" id="neg-connection"></div>
      <div class="connection-line" id="pos-connection"></div>
    </div>


    <!-- Measurement Display -->
    <div class="measurements">
      <div class="measurement" id="volts-display">Volts: --</div>
      <div class="measurement" id="amps-display">Amps: --</div>
    </div>


<button id="measureVoltsBtn">Measure Volts</button>

<button id="measureAmpsBtn">Measure Amps</button><br>

<br>

<div id="terminalSelection">
  <label><input type="radio" name="redTerminal" value="POS1" checked /> POS1</label>
  <label><input type="radio" name="redTerminal" value="POS2" /> POS2</label>
  <label><input type="radio" name="redTerminal" value="POS3" /> POS3</label>
</div>
  
<button id="clipRedBtn">Clip Red Lead</button>
<div id="clipStatus">Red lead not clipped yet.</div>

<br>

<div id="blackTerminalSelection">
  <label><input type="radio" name="blackTerminal" value="POS1" checked /> POS1</label>
  <label><input type="radio" name="blackTerminal" value="POS2" /> POS2</label>
  <label><input type="radio" name="blackTerminal" value="POS3" /> POS3</label>
</div>

<button id="clipBlackBtn">Clip Black Lead</button>
<div id="blackClipStatus">Black lead not clipped yet.</div>

<br>

<button id="testSwitchBtn">Throw Crossing Test Switch</button>
<div id="crossingStatus">Crossing Status: GATE NORMAL </div>

<br>


<button id="goldNutBtn">Open Test Nut</button>
<div id="nutStatus">Nut is closed.</div>

<br>

<button id="unclipLeadsBtn">Unclip Leads</button>
<button id="resetFuseBtn">Reset Meter Fuse</button>
<div id="fuseIndicator" style="display:none; color:red;">Fuse Blown</div>

<br>

<div id="meter-override-indicator" style="display: none; color: orange; font-weight: bold;">
  Meter Override Active
</div>


  </div>


<script>

let redClip = null;
let blackClip = null;



// START OF SUB ROUTINE SYSTEM 


// report connection when press volts and lock neg1 sub routine

function reportConnectRedLead() {
  document.getElementById("volts-display").textContent = "Volts: 0 V";
  document.getElementById("amps-display").textContent = "Amps: --";
  
  // Simulate auto-connection of black lead to NEG1
  document.getElementById("blackClipStatus").textContent = "Black lead auto-connected to NEG1.";
}

// volts reading logic woith toggle of nut

let nutIsOpen = false; // initial state

function handleNutToggle() {
  nutIsOpen = !nutIsOpen; // flip the state


  const pos2 = document.getElementById("positive2");
  const nutStatus = document.getElementById("nutStatus");

  if (nutIsOpen) {
    // Nut is now open
    nutStatus.textContent = "Nut is open.";
    pos2.style.backgroundColor = "#f9d976"; // lighter gold
    pos2.style.borderColor = "#e6c56e";
  } else {
    // Nut is now closed
    nutStatus.textContent = "Nut is closed.";
    pos2.style.backgroundColor = "#d4af37"; // normal gold
    pos2.style.borderColor = "#b8860b";
  }

  // Voltage logic inside nut toggler 

  if (currentMode === "volts") {
  if (redClip === "POS2" || redClip === "POS3") {
  document.getElementById("volts-display").textContent = nutIsOpen ? "Voltage: 0V" : "Voltage: 12V";
} else if (redClip === "POS1") {
  document.getElementById("volts-display").textContent = "Voltage: 12V";
}
}
}

  // updates voltage after clip change 

  function handleClipChange(newClip) {
  redClip = newClip;
  updateVoltageDisplay(); // ← this ensures voltage updates live
  if (currentMode === "volts" && redLeadClipped) {
  updateVoltageDisplay();
}
}



// volts reading logic with no toggle of nut

function updateVoltageDisplay() {
  const voltsDisplay = document.getElementById("volts-display");

if (currentMode === "volts") {
  if (redClip === "POS1") {
    voltsDisplay.textContent = "Voltage: 12V";
  } else if ((redClip === "POS2" || redClip === "POS3") && !nutIsOpen) {
    voltsDisplay.textContent = "Voltage: 12V";
  } else {
    voltsDisplay.textContent = "Voltage: 0V";
  }

}
}

// measure amps sub routine

function handleMeasureAmps() {
  document.getElementById("volts-display").textContent = "Voltage: --";
  let amps = "0A";
  let crossingStatus = "";

  // Nut is open and correct clips are in place
  if (nutIsOpen && redClip === "POS1" && blackClip === "POS3") {
    amps = "5A";
    crossingStatus = "Gate Normal meter in";
  }
  // Nut is open but clips are wrong or missing
  else if (nutIsOpen && (redClip !== "POS1" || blackClip !== "POS3")) {
    amps = "0A";
    crossingStatus = "Gate Down";
  }
  // Nut is closed — default state
  else {
    amps = "0A";
    
  }


  // Special case: redClip on POS2 and nut is closed, then opened
  if (redClip === "POS2" && nutIsOpen) {
    amps = "0A";
    crossingStatus = "Gate Down";
  }
 

  // Update UI

  document.getElementById("amps-display").textContent = `Current: ${amps}`;

  if (crossingStatus) document.getElementById("crossingStatus").textContent = crossingStatus;

  reportConnectionRedLead(); // still validate red lead
}


// mode volts or amps result sub routine

function updateMeasurement() {
  if (currentMode === "volts") {
    updateVoltageDisplay();
  } else if (currentMode === "amps") {
    handleMeasureAmps();
  }
}



// EVENTS TO CALL SUB ROUTINES

// start out blank and select measure 

window.addEventListener("DOMContentLoaded", () => {
  document.getElementById("volts-display").textContent = "Volts: --";
  document.getElementById("amps-display").textContent = "Amps: --";
});

// measure volts button click result

document.getElementById("measureVoltsBtn").addEventListener("click", () => {
  currentMode = "volts";
  document.getElementById("volts-display").textContent = "Volts: 0 V";
  document.getElementById("amps-display").textContent = "Current: --";
  updateMeasurement(); // Re-check clips and nut
});

// red lead clip logic volts 

document.getElementById("clipRedBtn").addEventListener("click", () => {
  const selected = document.querySelector('input[name="redTerminal"]:checked');
  const redTerminal = selected ? selected.value : null;

  if (redTerminal) {
    handleClipChange(redTerminal); // ← use your subroutine here
    document.getElementById("clipStatus").textContent = `Red lead clipped to ${redTerminal}.`;
  } else {
    document.getElementById("clipStatus").textContent = "Please select a red terminal.";
    document.getElementById("volts-display").textContent = "Voltage: --";
  }


if (currentMode === "volts" && redLeadClipped) {
  updateVoltageDisplay();
}

});

// unclip leads

document.getElementById("unclipLeadsBtn").addEventListener("click", () => {
  redClip = null; // clear red lead latch
  document.getElementById("clipStatus").textContent = "Leads unclipped.";
  document.getElementById("volts-display").textContent = "Voltage: 0V"; // reset volts display
});

// nut open button click

document.getElementById("goldNutBtn").addEventListener("click", handleNutToggle);


// measure amps button click

document.getElementById("measureAmpsBtn").addEventListener("click", () => {
  currentMode = "amps";
  document.getElementById("volts-display").textContent = "Voltage: --";
  document.getElementById("amps-display").textContent = "Current: 0 A";
  updateMeasurement(); // Re-check clips and nut
});



</script>


</body>
</html>
