<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Battery Tester</title>
  <style>
    /* Battery Housing Container */
    #battery-popup {
      width: 300px;
      margin: 50px auto;
      padding: 20px;
      background-color: #f5f5f5;
      border: 2px solid #333;
      border-radius: 10px;
      font-family: sans-serif;

    }

    /* Battery Box */
    .battery-box {
      position: relative;
      width: 100%;
      height: 120px;
      background-color: #c0c0c0;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    /* Terminals */
    .terminal {
      position: absolute;
      width: 20px;
      height: 20px;
      background-color: #333;
      border-radius: 50%;
    }

    .positive {
      background-color: red;
    }

    .negative {
      background-color: black;
    }

    /* Positioning Terminals */
    #positive1 { top: 10px; left: -300px; }
    #positive2 {
     top: 40px;
     left: -301px;
     background-color: gold;
     border: 2px solid #cfa02c; /* Give it a little metallic definition */
     cursor: pointer;           /* Suggest interactivity */
}
    #positive3 { top: 70px; left: -300px; }

    #negative1 { bottom: 80px; left: -100px; }
    #negative2 { bottom: 50px; left: -100px; }

 /* Connection Lines */
    .connection-line {
      position: absolute;
      height: 2px;
      background-color: #000;
    }

#neg-connection {
  left: -91px;              /* Move it toward the left */
  top: 20px;               /* Set its vertical position */
  width: 2px;              /* Skinny width since it's now vertical */
  height: 30px;           /* Tall height to span vertically */
  background-color: black; /* Line color */
}


#pos-connection {
  left: -291px;              /* Move it toward the left */
  top: 20px;               /* Set its vertical position */
  width: 2px;              /* Skinny width since it's now vertical */
  height: 60px;           /* Tall height to span vertically */
  background-color: red; /* Line color */
}


    /* Measurements Display */
    .measurements {
      display: flex;
      flex-direction: column;
      gap: 5px;
      margin-bottom: 10px;
    }

    .measurement {
      font-weight: bold;
      background: #fff;
      padding: 5px;
      border: 1px solid #aaa;
      border-radius: 5px;
    }


    }


    }
#testSwitchBtn {
  padding: 10px;
  background-color: #ffa500;
  border: none;
  border-radius: 5px;
  color: #000;
  font-weight: bold;
  margin-top: 10px;
  cursor: pointer;
}

#testSwitchBtn:hover {
  background-color: #cc8400;
}

#crossingStatus {
  margin-top: 10px;
  font-weight: bold;
}
  </style>
</head>
<body>

  <!-- Battery Tester Popup Interface -->
  <div id="battery-popup">

    <!-- Battery Housing -->
    <div class="battery-box">

      <!-- Terminals -->
      <div class="terminal positive" id="positive1"></div>
      <div class="terminal positive" id="positive2"></div>
      <div class="terminal positive" id="positive3"></div>

      <div class="terminal negative" id="negative1"></div>
      <div class="terminal negative" id="negative2"></div>

 <!-- Connection Lines -->
      <div class="connection-line" id="neg-connection"></div>
      <div class="connection-line" id="pos-connection"></div>
    </div>


    <!-- Measurement Display -->
    <div class="measurements">
      <div class="measurement" id="volts-display">Volts: --</div>
      <div class="measurement" id="amps-display">Amps: --</div>
    </div>


<button id="measureVoltsBtn">Measure Volts</button>

<button id="measureAmpsBtn">Measure Amps</button><br>

<br>

<div id="terminalSelection">
  <label><input type="radio" name="redTerminal" value="POS1" checked /> POS1</label>
  <label><input type="radio" name="redTerminal" value="POS2" /> POS2</label>
  <label><input type="radio" name="redTerminal" value="POS3" /> POS3</label>
</div>
  
<button id="clipRedBtn">Clip Red Lead</button>
<div id="clipStatus">Red lead not clipped yet.</div>

<br>

<div id="blackTerminalSelection">
  <label><input type="radio" name="blackTerminal" value="POS1" checked /> POS1</label>
  <label><input type="radio" name="blackTerminal" value="POS2" /> POS2</label>
  <label><input type="radio" name="blackTerminal" value="POS3" /> POS3</label>
</div>

<button id="clipBlackBtn">Clip Black Lead</button>
<div id="blackClipStatus">Black lead not clipped yet.</div>

<br>

<button id="testSwitchBtn">Throw Crossing Test Switch</button>
<div id="crossingStatus">Crossing Status: GATE NORMAL </div>

<br>


<button id="goldNutBtn">Open Test Nut</button>
<div id="nutStatus">Nut is closed.</div>

  </div>


<script>
  let nutClosed = true;
  let redClip = null;
  let blackClip = null;
  let clipStage = 0;
  let testMode = null; // Can be "voltage" or "amps"

  // Nut toggle + crossing status
  
console.log("Nut toggle triggered. New state:", nutClosed);

document.getElementById("goldNutBtn").addEventListener("click", () => {

  // Flip nut state
  nutClosed = !nutClosed;
  document.getElementById("goldNutBtn").textContent = nutClosed ? "Open Test Nut" : "Close Test Nut";

 // Recalculate amps if in amps mode
  if (testMode === "amps" && redClip && blackClip) {
  if (redClip === blackClip) {
    document.getElementById("amps-display").textContent = "Amps: -- (Leads on same terminal)";
    document.getElementById("crossingStatus").textContent = "Crossing Status: Invalid lead configuration";
    return;
  }
  
}


// Update status display
   const statusText = nutClosed ? "Nut is closed." : "Nut is open.";
   document.getElementById("nutStatus").textContent = statusText;

// Update volts display if in voltage mode
  if (testMode === "voltage" && redClip) {
  let volts = "0V";
  if (redClip === "POS1") {
    volts = "12V";
  } else if ((redClip === "POS2" || redClip === "POS3") && nutClosed) {
    volts = "12V";
  }
  document.getElementById("volts-display").textContent = `Volts (${redClip}): ${volts}`;
}


  // Change crossing logic (just for visual realism)
  const crossingText = nutClosed ? "Crossing Status: GATE NORMAL" : "Crossing Status: GATE DOWN";
  document.getElementById("crossingStatus").textContent = crossingText;


  // Recalculate amps if in amps mode and both leads are clipped
  if (testMode === "amps" && redClip && blackClip) {
  let amps = "--";
  const isNutOpen = !nutClosed;
  const meterInCircuit = redClip && blackClip;


  if (isNutOpen && meterInCircuit) {
    amps = "5.0A";
    gateState = "GATE NORMAL";
  } else if (nutClosed && meterInCircuit) {
    amps = "0.0A";
    gateState = "GATE NORMAL";
  } else {
    amps = "--";
    gateState = "METER OUT";
  }

  document.getElementById("amps-display").textContent = `Amps: ${amps}`;
  document.getElementById("crossingStatus").textContent = `Crossing Status: ${gateState}`;
}

 // ðŸ”§ Update POS2 and POS3 visibility based on nut state
  const pos2 = document.getElementById("positive2");
  const pos3 = document.getElementById("positive3");

  if (!nutClosed) {
  // Nut is open â€“ dim POS2 
  pos2.style.opacity = "0.3";
  

  // Clear red lead if clipped to inactive terminal
  if (redClip === "POS2" || redClip === "POS3") {
    redClip = null;
    clipStage = 0;
    document.getElementById("clipStatus").textContent = "Red lead needs re-clipping.";
    document.getElementById("volts-display").textContent = "Volts: --";
    document.getElementById("amps-display").textContent = "Amps: --";
    document.getElementById("crossingStatus").textContent = "Crossing Status: GATE DOWN";

  }
} else {
  // Nut is closed â€“ restore full visibility
  pos2.style.opacity = "1";
  pos3.style.opacity = "1";
}
});

  // Step 1: Clip Red Lead
    document.getElementById("clipRedBtn").addEventListener("click", () => {
  const selected = document.querySelector('input[name="redTerminal"]:checked');
  redClip = selected ? selected.value : null;

  clipStage = 1;
  document.getElementById("clipStatus").textContent = `Red lead clipped to ${redClip}.`;
  document.getElementById("amps-display").textContent = "Amps: --";

  if (!nutClosed) {
  document.getElementById("crossingStatus").textContent = "Crossing Status: GATE DOWN";
} else {
  document.getElementById("crossingStatus").textContent = "Crossing Status: GATE NORMAL";
}

  

  if (testMode === "voltage") {
    blackClip = "NEG1";
    document.getElementById("blackClipStatus").textContent = "Black lead automatically placed on NEG1 (voltage test)";
    document.getElementById("blackTerminalSelection").style.display = "none";

    // Voltage preview logic if needed
    let volts = "0V";
    const activeWhenNutOpen = redClip === "POS1";
    if (nutClosed || activeWhenNutOpen) {
      volts = "12V";
    }
    document.getElementById("volts-display").textContent = `Volts: ${volts}`;
    document.getElementById("amps-display").textContent = "Amps: --";
  } else if (testMode === "amps") {

    // For amps test, wait until black lead is manually clipped to POS3
    document.getElementById("blackClipStatus").textContent = "Ready to clip black lead for current test.";
    document.getElementById("blackTerminalSelection").style.display = "block";
    document.getElementById("volts-display").textContent = "Volts: --";
    document.getElementById("amps-display").textContent = "Amps: --";


  }
  if (testMode === "amps") {
  performAmpsMeasurement();
}
});
  // Step 2: Clip Black Lead
  document.getElementById("clipBlackBtn").addEventListener("click", () => {
  const selected = document.querySelector('input[name="blackTerminal"]:checked');
  blackClip = selected ? selected.value : null;

  if (clipStage !== 1) {
    document.getElementById("blackClipStatus").textContent = "Please clip red lead first.";
    return;
  }

  clipStage = 2;
  document.getElementById("blackClipStatus").textContent = `Black lead clipped to ${blackClip}.`;

  // Trigger amps read immediately if in amps mode
  function performAmpsMeasurement() {
  if (testMode !== "amps" || !redClip || !blackClip) return;

  let amps = "--";
  let gateState = "METER OUT";
  const isNutOpen = !nutClosed;

  if (redClip === blackClip) {
    amps = "--";
    gateState = "Invalid lead configuration";
  } else if (
    (redClip === "POS2" && blackClip === "POS3") ||
    (redClip === "POS3" && blackClip === "POS2")
  ) {
    amps = "0.0A";
    gateState = isNutOpen ? "GATE DOWN" : "GATE NORMAL";
  } else if (
    (redClip === "POS1" && blackClip === "POS3") ||
    (redClip === "POS3" && blackClip === "POS1")
  ) {
    if (isNutOpen) {
      amps = "20.0A";
      gateState = "GATE UP METER IN";
      document.getElementById("amps-display").textContent = `Amps: ${amps}`;
      document.getElementById("crossingStatus").textContent = `Crossing Status: ${gateState}`;
      setTimeout(() => {
        document.getElementById("amps-display").textContent = "Amps: 5.0A";
        document.getElementById("crossingStatus").textContent = "Crossing Status: GATE NORMAL";
      }, 5000);
      return;
    } else {
      amps = "0.0A";
      gateState = "GATE NORMAL";
    }
  } else {
    amps = isNutOpen ? "5.0A" : "0.0A";
    gateState = isNutOpen ? "GATE DOWN" : "GATE NORMAL";
  }

  document.getElementById("amps-display").textContent = `Amps: ${amps}`;
  document.getElementById("crossingStatus").textContent = `Crossing Status: ${gateState}`;
}

  if (testMode === "amps") {
  performAmpsMeasurement();
}

});
  // Step 3: Measure Voltage
     document.getElementById("measureVoltsBtn").addEventListener("click", () => {
     testMode = "voltage";

    // Unclip leads and update crossing status based on nut state
    redClip = null;
    blackClip = null;
    clipStage = 0;
    document.getElementById("clipStatus").textContent = "Red lead not clipped yet.";
    document.getElementById("blackClipStatus").textContent = "Black lead not clipped yet.";
    document.getElementById("volts-display").textContent = "Volts: --";
    document.getElementById("amps-display").textContent = "Amps: --";

  if (!nutClosed) {
  document.getElementById("crossingStatus").textContent = "Crossing Status: GATE DOWN";
} else {
  document.getElementById("crossingStatus").textContent = "Crossing Status: GATE NORMAL";
}

  // Hide black terminal selector and POS1â€“POS3 (only now!)
  document.getElementById("blackTerminalSelection").style.display = "none";


  // Auto-clip black lead to NEG1
  blackClip = "NEG1";
  document.getElementById("blackClipStatus").textContent = "Black lead automatically placed on NEG1 (voltage test)";

  // Clear amps display
  document.getElementById("amps-display").textContent = "Amps: --";

  // Validate red clip presence
  if (!redClip) {
    document.getElementById("volts-display").textContent = "Volts: -- (Red lead not clipped)";
    return;
  }

  let volts = "0V";
  const isNutOpen = !nutClosed;

  if (redClip === "POS1") {
  volts = "12V"; // POS1 always active
} else if ((redClip === "POS2" || redClip === "POS3") && nutClosed) {
  volts = "12V"; // POS2/POS3 only active when nut is closed
} else {
  volts = "0V"; // Otherwise, no voltage
}
  document.getElementById("volts-display").textContent = `Volts: ${volts}`;
});


  // Amps button placeholder
  document.getElementById("measureAmpsBtn").addEventListener("click", () => {
  testMode = "amps";

  // Unclip leads and update crossing status based on nut state
  redClip = null;
  blackClip = null;
  clipStage = 0;
  document.getElementById("clipStatus").textContent = "Red lead not clipped yet.";
  document.getElementById("blackClipStatus").textContent = "Black lead not clipped yet.";
  document.getElementById("volts-display").textContent = "Volts: --";
  document.getElementById("amps-display").textContent = "Amps: --";

  // Reset gateState based on nut state alone
  let gateState = nutClosed ? "GATE NORMAL" : "GATE DOWN";
  document.getElementById("crossingStatus").textContent = `Crossing Status: ${gateState}`;

  // Show terminals and black clip selector again for amp testing
  document.getElementById("positive1").style.display = "block";
  document.getElementById("positive2").style.display = "block";
  document.getElementById("positive3").style.display = "block";
  document.getElementById("blackTerminalSelection").style.display = "block";
  document.getElementById("blackClipStatus").textContent = "";
});

  // Crossing Test Switch
  document.getElementById("testSwitchBtn").addEventListener("click", () => {
    document.getElementById("crossingStatus").textContent = "Crossing Status: Test Triggered";
  });
</script>


</body>
</html>
